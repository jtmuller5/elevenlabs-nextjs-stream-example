# Streaming with Next.js

This repository demonstrates how to implement streaming responses in a Next.js application. It includes examples of streaming audio files, text messages, and text-to-speech (TTS) audio using the ElevenLabs API.

## Table of Contents

	‚Ä¢	Introduction
	‚Ä¢	Prerequisites
	‚Ä¢	Installation
	‚Ä¢	Environment Variables
	‚Ä¢	Running the Application
	‚Ä¢	API Endpoints
	‚Ä¢	/stream/audio
	‚Ä¢	/stream/text
	‚Ä¢	/stream/tts
	‚Ä¢	Testing the Endpoints
	‚Ä¢	Notes
	‚Ä¢	License

## Introduction

This Next.js application showcases how to use the Web Streams API to stream data to clients. It includes three API routes under the /stream path:
	‚Ä¢	/stream/audio: Streams an audio file in chunks.
	‚Ä¢	/stream/text: Streams text messages with delays between them.
	‚Ä¢	/stream/tts: Streams text-to-speech audio generated by the ElevenLabs API.

### Prerequisites

	‚Ä¢	Node.js v14 or later
	‚Ä¢	npm or yarn package manager
	‚Ä¢	An API key for ElevenLabs (required for the /stream/tts endpoint)

### Installation

	1.	Clone the repository:

git clone https://github.com/your-username/your-repo.git
cd your-repo


	2.	Install dependencies:
Using npm:

npm install

Or using yarn:

yarn install


	3.	Add an audio file:
	‚Ä¢	Place an audio.mp3 file in the public directory of the project root. This file will be used by the /stream/audio endpoint.

### Environment Variables

Create a .env.local file in the root directory and add the following environment variable:

ELEVENLABS_API_KEY=your_elevenlabs_api_key

Replace your_elevenlabs_api_key with your actual API key from ElevenLabs.

## Running the Application

Start the development server:

Using npm:

npm run dev

Or using yarn:

yarn dev

The application will be running at http://localhost:3000.

## API Endpoints

### /stream/audio

	‚Ä¢	Description: Streams an audio file (audio.mp3) in chunks of 64KB to the client.
	‚Ä¢	Method: GET
	‚Ä¢	Response Headers:
	‚Ä¢	Content-Type: audio/mpeg
	‚Ä¢	Cache-Control: no-cache
	‚Ä¢	Connection: keep-alive

Implementation Details

	‚Ä¢	Reads the audio.mp3 file from the public directory.
	‚Ä¢	Uses a ReadableStream to stream the file in chunks.
	‚Ä¢	Adds a small delay between chunks to simulate real-time streaming.

Usage

curl http://localhost:3000/stream/audio --output streamed_audio.mp3

### /stream/text
Description: Streams a series of text messages to the client, with a delay between each message.
	‚Ä¢	Method: GET
	‚Ä¢	Response Headers:
	‚Ä¢	Content-Type: text/event-stream
	‚Ä¢	Cache-Control: no-cache
	‚Ä¢	Connection: keep-alive

Implementation Details

	‚Ä¢	Uses a ReadableStream to stream text messages.
	‚Ä¢	Messages are encoded using TextEncoder.
	‚Ä¢	Delays of 1 second between messages simulate processing time.

Messages Streamed

	1.	‚Äúüëã Hello from the stream!‚Äù
	2.	‚ÄúüöÄ Loading your data‚Ä¶‚Äù
	3.	‚Äúüì¶ Processing items‚Ä¶‚Äù
	4.	‚Äú‚ú® Almost there‚Ä¶‚Äù
	5.	‚Äú‚úÖ Stream complete!‚Äù

Usage

curl http://localhost:3000/stream/text

### /stream/tts

Description: Streams text-to-speech audio generated by the ElevenLabs API.
	‚Ä¢	Method: GET
	‚Ä¢	Response Headers:
	‚Ä¢	Content-Type: audio/mpeg
	‚Ä¢	Cache-Control: no-cache
	‚Ä¢	Connection: keep-alive

Implementation Details

	‚Ä¢	Utilizes the ElevenLabs API to generate TTS audio.
	‚Ä¢	Streams the audio data directly to the client.
	‚Ä¢	Voice used: ‚ÄúJessica‚Äù
	‚Ä¢	Text: ‚ÄúThis is a‚Ä¶ streaming voice‚Äù
	‚Ä¢	Model ID: ‚Äúeleven_turbo_v2_5‚Äù
	‚Ä¢	Output Format: ‚Äúmp3_44100_64‚Äù

Usage

curl http://localhost:3000/stream/tts --output tts_audio.mp3

Testing the Endpoints

You can test the endpoints using curl, Postman, or any HTTP client.

### Testing /stream/audio

curl http://localhost:3000/stream/audio --output streamed_audio.mp3

	‚Ä¢	This command will save the streamed audio to streamed_audio.mp3.

### Testing /stream/text

curl http://localhost:3000/stream/text

	‚Ä¢	You should see the messages printed with delays between them.

### Testing /stream/tts

curl http://localhost:3000/stream/tts --output tts_audio.mp3

	‚Ä¢	This command will save the TTS audio to tts_audio.mp3.

## Notes

	‚Ä¢	ElevenLabs API Key: Ensure that you have a valid API key from ElevenLabs and that you have sufficient quota for TTS generation.
	‚Ä¢	Audio File: The audio.mp3 file should be placed in the public directory before running the application.
	‚Ä¢	Delays in Streaming: The delays added in the streaming functions simulate real-time data processing and can be adjusted or removed as needed.
	‚Ä¢	Content Types: The Content-Type headers in the responses are important for the client to correctly handle the streamed data.

## License

This project is open-source and available under the MIT License.